import{d as qe,f as x,a as h,s as m}from"../chunks/BpQGbxjQ.js";import{ad as de,M as g,a2 as ve,t as ze,ae as Ee,af as De,ag as Me,ah as ce,D as te,ai as se,aj as Pe,u as $e,ak as je,x as Ce,W as Ne,X as t,Z as l,$ as Y,b as i,_ as C,a0 as Oe,s as z,a3 as Ve,Y as r}from"../chunks/CeX5bisY.js";import{i as Z}from"../chunks/J5d8E7TX.js";import{c as We,s as _,e as ne,t as Te,d as Fe,b as He}from"../chunks/CFnnMLjb.js";import{h as Ie}from"../chunks/Dbh3RtVr.js";import{r as ie,s as le}from"../chunks/D688N9uT.js";function ue(e,s,v=!1){if(e.multiple){if(s==null)return;if(!Ee(s))return De();for(var o of e.options)o.selected=s.includes(M(o));return}for(o of e.options){var d=M(o);if(Me(d,s)){o.selected=!0;return}}(!v||s!==void 0)&&(e.selectedIndex=-1)}function Le(e){var s=new MutationObserver(()=>{ue(e,e.__value)});s.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ze(()=>{s.disconnect()})}function Re(e,s,v=s){var o=new WeakSet,d=!0;de(e,"change",n=>{var b=n?"[selected]":":checked",u;if(e.multiple)u=[].map.call(e.querySelectorAll(b),M);else{var y=e.querySelector(b)??e.querySelector("option:not([disabled])");u=y&&M(y)}v(u),g!==null&&o.add(g)}),ve(()=>{var n=s();if(e===document.activeElement){var b=ce??g;if(o.has(b))return}if(ue(e,n,d),d&&n===void 0){var u=e.querySelector(":checked");u!==null&&(n=M(u),v(n))}e.__value=n,d=!1}),Le(e)}function M(e){return"__value"in e?e.__value:e.value}function oe(e,s,v=s){var o=new WeakSet;de(e,"input",async d=>{te&&e.type==="checkbox"&&se();var n=d?e.defaultValue:e.value;if(n=B(e)?G(n):n,v(n),g!==null&&o.add(g),await Pe(),n!==(n=s())){var b=e.selectionStart,u=e.selectionEnd,y=e.value.length;if(e.value=n??"",u!==null){var k=e.value.length;b===u&&u===y&&k>y?(e.selectionStart=k,e.selectionEnd=k):(e.selectionStart=b,e.selectionEnd=Math.min(u,k))}}}),(Ce&&e.defaultValue!==e.value||$e(s)==null&&e.value)&&(v(B(e)?G(e.value):e.value),g!==null&&o.add(g)),je(()=>{te&&e.type==="checkbox"&&se();var d=s();if(e===document.activeElement){var n=ce??g;if(o.has(n))return}B(e)&&d===G(e.value)||e.type==="date"&&!d&&!e.value||d!==e.value&&(e.value=d??"")})}function B(e){var s=e.type;return s==="number"||s==="range"}function G(e){return e===""?null:+e}var Xe=x('<p class="text-[var(--muted)]">No schedules yet</p>'),Ye=x('<div><div class="flex items-center gap-4"><span class="text-xl font-mono"> </span> <div><span class="font-medium"> </span> <span class="text-sm text-[var(--muted)] ml-2"> </span></div></div> <div class="flex gap-2"><button> </button> <button class="text-sm px-3 py-1 rounded bg-red-900 hover:bg-red-800">Delete</button></div></div>'),Ze=x('<div class="space-y-2"></div>'),Be=x('<button class="text-sm px-3 py-1 rounded bg-zinc-700 hover:bg-zinc-600">Clear All</button>'),Ge=x('<p class="text-[var(--muted)]">No pending actions (all lamps online)</p>'),Je=x('<div class="bg-[var(--card)] border border-[var(--border)] rounded-lg p-3 flex items-center justify-between"><div><span class="font-mono text-sm"> </span> <span class="text-sm text-[var(--muted)] ml-2"> </span></div> <span class="text-xs text-[var(--muted)]"> </span></div>'),Ke=x('<div class="space-y-2"></div>'),Qe=x('<div class="space-y-8"><section class="bg-[var(--card)] border border-[var(--border)] rounded-lg p-4"><h2 class="text-lg font-medium mb-4">Create Schedule</h2> <div class="flex flex-wrap gap-3"><input type="text" placeholder="Schedule name" class="bg-zinc-800 border border-[var(--border)] rounded px-3 py-2 flex-1 min-w-[150px]"/> <select class="bg-zinc-800 border border-[var(--border)] rounded px-3 py-2"><option>Day Mode</option><option>Night Mode</option><option>All Off</option></select> <input type="time" class="bg-zinc-800 border border-[var(--border)] rounded px-3 py-2"/> <button class="bg-[var(--accent)] hover:bg-blue-600 disabled:opacity-50 px-4 py-2 rounded">Add</button></div></section> <section><h2 class="text-lg font-medium mb-4"> </h2> <!></section> <section><div class="flex items-center justify-between mb-4"><h2 class="text-lg font-medium"> </h2> <!></div> <!></section></div>');function na(e,s){Ne(s,!0);let v=C(""),o=C("night"),d=C("19:00"),n=C(!1);async function b(){if(i(v).trim()){z(n,!0);try{await We(i(v).trim(),i(o),i(d)),z(v,""),await _.refreshSchedules()}catch(a){console.error(a)}z(n,!1)}}async function u(a){await Fe(a),await _.refreshSchedules()}async function y(a){await Te(a),await _.refreshSchedules()}async function k(){await He(),await _.refreshPending()}var N=Qe();Ie("19rgvlq",a=>{ve(()=>{Ve.title="Smart Home - Schedule"})});var O=t(N),J=l(t(O),2),V=t(J);ie(V);var P=l(V,2),W=t(P);W.value=W.__value="day";var T=l(W);T.value=T.__value="night";var K=l(T);K.value=K.__value="off",r(P);var F=l(P,2);ie(F);var Q=l(F,2);Q.__click=b,r(J),r(O);var H=l(O,2),I=t(H),fe=t(I);r(I);var _e=l(I,2);{var be=a=>{var c=Xe();h(a,c)},me=a=>{var c=Ze();ne(c,21,()=>_.schedules,S=>S.id,(S,f)=>{var p=Ye();let A;var w=t(p),E=t(w),$=t(E,!0);r(E);var j=l(E,2),q=t(j),X=t(q,!0);r(q);var ee=l(q,2),we=t(ee);r(ee),r(j),r(w);var ae=l(w,2),D=t(ae);D.__click=()=>y(i(f).id);let re;var ke=t(D,!0);r(D);var Ae=l(D,2);Ae.__click=()=>u(i(f).id),r(ae),r(p),Y(()=>{A=le(p,1,"bg-[var(--card)] border border-[var(--border)] rounded-lg p-3 flex items-center justify-between",null,A,{"opacity-50":!i(f).enabled}),m($,i(f).time),m(X,i(f).name),m(we,`(${i(f).preset??""})`),re=le(D,1,"text-sm px-3 py-1 rounded",null,re,{"bg-green-800":i(f).enabled,"bg-zinc-700":!i(f).enabled}),m(ke,i(f).enabled?"On":"Off")}),h(S,p)}),r(c),h(a,c)};Z(_e,a=>{_.schedules.length===0?a(be):a(me,!1)})}r(H);var U=l(H,2),L=t(U),R=t(L),pe=t(R);r(R);var he=l(R,2);{var ge=a=>{var c=Be();c.__click=k,h(a,c)};Z(he,a=>{_.pendingActions.length>0&&a(ge)})}r(L);var xe=l(L,2);{var ye=a=>{var c=Ge();h(a,c)},Se=a=>{var c=Ke();ne(c,21,()=>_.pendingActions,S=>S.id,(S,f)=>{var p=Je(),A=t(p),w=t(A),E=t(w,!0);r(w);var $=l(w,2),j=t($);r($),r(A);var q=l(A,2),X=t(q);r(q),r(p),Y(()=>{m(E,i(f).device_id),m(j,`â†’ ${i(f).preset??""}`),m(X,`Retry #${i(f).retry_count??""}`)}),h(S,p)}),r(c),h(a,c)};Z(xe,a=>{_.pendingActions.length===0?a(ye):a(Se,!1)})}r(U),r(N),Y(a=>{Q.disabled=a,m(fe,`Schedules (${_.schedules.length??""})`),m(pe,`Pending Actions (${_.pendingActions.length??""})`)},[()=>i(n)||!i(v).trim()]),oe(V,()=>i(v),a=>z(v,a)),Re(P,()=>i(o),a=>z(o,a)),oe(F,()=>i(d),a=>z(d,a)),h(e,N),Oe()}qe(["click"]);export{na as component};
