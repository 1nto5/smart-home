import{w as Y,n as fe,B as J,x,y as ue,G as oe,b as S,a as le,I as ce,J as de,K as ee,A as z,F as H,C as he,al as ve,am as re,M as ge,an as A,R as B,U as pe,D as me,v as ye,ao as ae,ap as U,ae as Se,aq as _e,ar as Ee,as as Te,N as te,Q as se,at as q,z as Ae,au as we,O as Pe,av as ie,a6 as be,aw as Oe,_ as w,c as L,s as E}from"./CeX5bisY.js";function Je(e,n){return n}function De(e,n,t){for(var h=[],v=n.length,u,f=n.length,l=0;l<v;l++){let p=n[l];se(p,()=>{if(u){if(u.pending.delete(p),u.done.add(p),u.pending.size===0){var c=e.outrogroups;V(U(u.done)),c.delete(u),c.size===0&&(e.outrogroups=null)}}else f-=1},!1)}if(f===0){var s=h.length===0&&t!==null;if(s){var o=t,a=o.parentNode;we(a),a.append(o),e.items.clear()}V(n,!s)}else u={pending:new Set(n),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(u)}function V(e,n=!0){for(var t=0;t<e.length;t++)Pe(e[t],n)}var ne;function ze(e,n,t,h,v,u=null){var f=e,l=new Map,s=(n&ie)!==0;if(s){var o=e;f=x?J(ue(o)):o.appendChild(Y())}x&&oe();var a=null,p=le(()=>{var i=t();return Se(i)?i:i==null?[]:U(i)}),c,g=!0;function b(){r.fallback=a,Ne(r,c,f,n,h),a!==null&&(c.length===0?(a.f&A)===0?te(a):(a.f^=A,F(a,null,f)):se(a,()=>{a=null}))}var N=fe(()=>{c=S(p);var i=c.length;let C=!1;if(x){var k=ce(f)===de;k!==(i===0)&&(f=ee(),J(f),z(!1),C=!0)}for(var _=new Set,O=ge,I=pe(),m=0;m<i;m+=1){x&&H.nodeType===he&&H.data===ve&&(f=H,C=!0,z(!1));var D=c[m],R=h(D,m),y=g?null:l.get(R);y?(y.v&&re(y.v,D),y.i&&re(y.i,m),I&&O.skipped_effects.delete(y.e)):(y=Ce(l,g?f:ne??(ne=Y()),D,R,m,v,n,t),g||(y.e.f|=A),l.set(R,y)),_.add(R)}if(i===0&&u&&!a&&(g?a=B(()=>u(f)):(a=B(()=>u(ne??(ne=Y()))),a.f|=A)),x&&i>0&&J(ee()),!g)if(I){for(const[M,$]of l)_.has(M)||O.skipped_effects.add($.e);O.oncommit(b),O.ondiscard(()=>{})}else b();C&&z(!0),S(p)}),r={effect:N,items:l,outrogroups:null,fallback:a};g=!1,x&&(f=H)}function Ne(e,n,t,h,v){var y,M,$,G,K,Q,X,W,Z;var u=(h&Oe)!==0,f=n.length,l=e.items,s=e.effect.first,o,a=null,p,c=[],g=[],b,N,r,i;if(u)for(i=0;i<f;i+=1)b=n[i],N=v(b,i),r=l.get(N).e,(r.f&A)===0&&((M=(y=r.nodes)==null?void 0:y.a)==null||M.measure(),(p??(p=new Set)).add(r));for(i=0;i<f;i+=1){if(b=n[i],N=v(b,i),r=l.get(N).e,e.outrogroups!==null)for(const T of e.outrogroups)T.pending.delete(r),T.done.delete(r);if((r.f&A)!==0)if(r.f^=A,r===s)F(r,null,t);else{var C=a?a.next:s;r===e.effect.last&&(e.effect.last=r.prev),r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),P(e,a,r),P(e,r,C),F(r,C,t),a=r,c=[],g=[],s=a.next;continue}if((r.f&q)!==0&&(te(r),u&&((G=($=r.nodes)==null?void 0:$.a)==null||G.unfix(),(p??(p=new Set)).delete(r))),r!==s){if(o!==void 0&&o.has(r)){if(c.length<g.length){var k=g[0],_;a=k.prev;var O=c[0],I=c[c.length-1];for(_=0;_<c.length;_+=1)F(c[_],k,t);for(_=0;_<g.length;_+=1)o.delete(g[_]);P(e,O.prev,I.next),P(e,a,O),P(e,I,k),s=k,a=I,i-=1,c=[],g=[]}else o.delete(r),F(r,s,t),P(e,r.prev,r.next),P(e,r,a===null?e.effect.first:a.next),P(e,a,r),a=r;continue}for(c=[],g=[];s!==null&&s!==r;)(o??(o=new Set)).add(s),g.push(s),s=s.next;if(s===null)continue}(r.f&A)===0&&c.push(r),a=r,s=r.next}if(e.outrogroups!==null){for(const T of e.outrogroups)T.pending.size===0&&(V(U(T.done)),(K=e.outrogroups)==null||K.delete(T));e.outrogroups.size===0&&(e.outrogroups=null)}if(s!==null||o!==void 0){var m=[];if(o!==void 0)for(r of o)(r.f&q)===0&&m.push(r);for(;s!==null;)(s.f&q)===0&&s!==e.fallback&&m.push(s),s=s.next;var D=m.length;if(D>0){var R=(h&ie)!==0&&f===0?t:null;if(u){for(i=0;i<D;i+=1)(X=(Q=m[i].nodes)==null?void 0:Q.a)==null||X.measure();for(i=0;i<D;i+=1)(Z=(W=m[i].nodes)==null?void 0:W.a)==null||Z.fix()}De(e,m,R)}}u&&be(()=>{var T,j;if(p!==void 0)for(r of p)(j=(T=r.nodes)==null?void 0:T.a)==null||j.apply()})}function Ce(e,n,t,h,v,u,f,l){var s=(f&_e)!==0?(f&Ee)===0?ye(t,!1,!1):ae(t):null,o=(f&Te)!==0?ae(v):null;return me&&s&&(s.trace=()=>{l()[(o==null?void 0:o.v)??v]}),{v:s,i:o,e:B(()=>(u(n,s??t,o??v,l),()=>{e.delete(h)}))}}function F(e,n,t){if(e.nodes)for(var h=e.nodes.start,v=e.nodes.end,u=n&&(n.f&A)===0?n.nodes.start:t;h!==null;){var f=Ae(h);if(u.before(h),h===v)return;h=f}}function P(e,n,t){n===null?e.effect.first=t:n.next=t,t===null?e.effect.last=n:t.prev=n}const ke="http://localhost:3001/api";async function d(e,n){const t=await fetch(`${ke}${e}`,{...n,headers:{"Content-Type":"application/json",...n==null?void 0:n.headers}});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}async function Ie(){return d("/xiaomi")}async function qe(e){return d(`/xiaomi/${e}/status`)}async function Be(e,n){return d(`/xiaomi/${e}/control`,{method:"POST",body:JSON.stringify(n)})}async function Re(){return d("/roborock/status")}async function Ve(e){return d("/roborock/command",{method:"POST",body:JSON.stringify({cmd:e})})}async function Ue(){return d("/presets")}async function Ge(e){return d(`/presets/${e}/apply`,{method:"POST"})}async function xe(){return d("/schedules")}async function Ke(e,n,t){return d("/schedules",{method:"POST",body:JSON.stringify({name:e,preset:n,time:t})})}async function Qe(e){return d(`/schedules/${e}`,{method:"DELETE"})}async function Xe(e){return d(`/schedules/${e}/toggle`,{method:"PATCH"})}async function Le(){return d("/pending-actions")}async function We(){return d("/pending-actions",{method:"DELETE"})}async function Fe(){return d("/devices")}async function Me(){return d("/yamaha")}async function Ze(e){return d(`/yamaha/${e}/status`)}async function je(e,n){return d(`/yamaha/${e}/control`,{method:"POST",body:JSON.stringify(n)})}async function $e(){return d("/purifier/status")}async function er(e){return d("/purifier/control",{method:"POST",body:JSON.stringify(e)})}function He(){let e=w(L([])),n=L(new Map),t=w(null),h=w(L([])),v=w(L([])),u=w(L([])),f=w(L([])),l=w(null),s=w(!1),o=null;return{get lamps(){return S(e)},get lampStatuses(){return n},get roborock(){return S(t)},get schedules(){return S(h)},get pendingActions(){return S(v)},get tuyaDevices(){return S(u)},get yamahaDevices(){return S(f)},get airPurifier(){return S(l)},get loading(){return S(s)},get error(){return o},updateLampStatus(a,p){n.set(a,p)},async refreshLamps(){try{E(e,await Ie(),!0),console.log("Refreshed lamps:",S(e).length,S(e))}catch(a){console.error("Failed to fetch lamps:",a)}},async refreshRoborock(){try{E(t,await Re(),!0)}catch{E(t,null)}},async refreshSchedules(){try{E(h,await xe(),!0)}catch(a){console.error("Failed to fetch schedules:",a)}},async refreshPending(){try{E(v,await Le(),!0)}catch(a){console.error("Failed to fetch pending actions:",a)}},async refreshTuya(){try{E(u,await Fe(),!0)}catch(a){console.error("Failed to fetch Tuya devices:",a)}},async refreshYamaha(){try{E(f,await Me(),!0)}catch(a){console.error("Failed to fetch Yamaha devices:",a)}},async refreshAirPurifier(){try{E(l,await $e(),!0)}catch{E(l,null)}},async refreshAll(){E(s,!0),await Promise.all([this.refreshLamps(),this.refreshRoborock(),this.refreshSchedules(),this.refreshPending(),this.refreshTuya(),this.refreshYamaha(),this.refreshAirPurifier()]),E(s,!1)}}}const rr=He();export{Ge as a,We as b,Ke as c,Qe as d,ze as e,qe as f,Ue as g,Be as h,Ve as i,Je as j,Ze as k,je as l,er as m,rr as s,Xe as t};
