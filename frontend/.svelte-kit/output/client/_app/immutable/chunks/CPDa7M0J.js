import{w as Q,b as He,aq as Se,A as x,h as N,x as Ie,a as Le,g as S,V as Ce,F as Re,G as Me,I as he,z as V,B as W,C as De,ar as $e,as as ve,n as G,at as M,am as B,ao as Fe,D as be,N as Je,P as ge,au as ne,av as me,aw as qe,ax as Ye,ay as Ue,aj as Ae,al as Te,az as ee,q as Ee,y as Ve,aA as ze,aB as Be,ak as K,aC as Oe,e as se,l as We,K as Ge,aD as Ke,aE as je,v as Xe,aF as Ze,aG as Qe,aH as xe,aI as er,aJ as rr,aK as tr,aL as ar,aM as nr,aN as sr,aO as ir,d as k,W as R,j as A}from"./DAortCmQ.js";import{g as or,h as ur,d as cr,n as fr,j as lr}from"./B_G7EnjR.js";import{t as dr,a as hr,c as vr}from"./BH17u12g.js";function Ur(e,r){return r}function gr(e,r,t){for(var n=[],o=r.length,s,c=r.length,g=0;g<o;g++){let O=r[g];Te(O,()=>{if(s){if(s.pending.delete(O),s.done.add(O),s.pending.size===0){var d=e.outrogroups;te(ne(s.done)),d.delete(s),d.size===0&&(e.outrogroups=null)}}else c-=1},!1)}if(c===0){var u=n.length===0&&t!==null;if(u){var h=t,f=h.parentNode;Be(f),f.append(h),e.items.clear()}te(r,!u)}else s={pending:new Set(r),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(s)}function te(e,r=!0){for(var t=0;t<e.length;t++)K(e[t],r)}var ye;function Vr(e,r,t,n,o,s=null){var c=e,g=new Map,u=(r&Se)!==0;if(u){var h=e;c=N?x(Ie(h)):h.appendChild(Q())}N&&Le();var f=null,O=Ce(()=>{var i=t();return me(i)?i:i==null?[]:ne(i)}),d,b=!0;function T(){a.fallback=f,yr(a,d,c,r,n),f!==null&&(d.length===0?(f.f&M)===0?Ae(f):(f.f^=M,U(f,null,c)):Te(f,()=>{f=null}))}var w=He(()=>{d=S(O);var i=d.length;let m=!1;if(N){var P=Re(c)===Me;P!==(i===0)&&(c=he(),x(c),V(!1),m=!0)}for(var y=new Set,L=G,p=Fe(),v=0;v<i;v+=1){N&&W.nodeType===De&&W.data===$e&&(c=W,m=!0,V(!1));var E=d[v],H=n(E,v),_=b?null:g.get(H);_?(_.v&&ve(_.v,E),_.i&&ve(_.i,v),p&&L.skipped_effects.delete(_.e)):(_=pr(g,b?c:ye??(ye=Q()),E,H,v,o,r,t),b||(_.e.f|=M),g.set(H,_)),y.add(H)}if(i===0&&s&&!f&&(b?f=B(()=>s(c)):(f=B(()=>s(ye??(ye=Q()))),f.f|=M)),N&&i>0&&x(he()),!b)if(p){for(const[$,F]of g)y.has($)||L.skipped_effects.add(F.e);L.oncommit(T),L.ondiscard(()=>{})}else T();m&&V(!0),S(O)}),a={effect:w,items:g,outrogroups:null,fallback:f};b=!1,N&&(c=W)}function yr(e,r,t,n,o){var _,$,F,ie,oe,ue,ce,fe,le;var s=(n&ze)!==0,c=r.length,g=e.items,u=e.effect.first,h,f=null,O,d=[],b=[],T,w,a,i;if(s)for(i=0;i<c;i+=1)T=r[i],w=o(T,i),a=g.get(w).e,(a.f&M)===0&&(($=(_=a.nodes)==null?void 0:_.a)==null||$.measure(),(O??(O=new Set)).add(a));for(i=0;i<c;i+=1){if(T=r[i],w=o(T,i),a=g.get(w).e,e.outrogroups!==null)for(const C of e.outrogroups)C.pending.delete(a),C.done.delete(a);if((a.f&M)!==0)if(a.f^=M,a===u)U(a,null,t);else{var m=f?f.next:u;a===e.effect.last&&(e.effect.last=a.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),D(e,f,a),D(e,a,m),U(a,m,t),f=a,d=[],b=[],u=f.next;continue}if((a.f&ee)!==0&&(Ae(a),s&&((ie=(F=a.nodes)==null?void 0:F.a)==null||ie.unfix(),(O??(O=new Set)).delete(a))),a!==u){if(h!==void 0&&h.has(a)){if(d.length<b.length){var P=b[0],y;f=P.prev;var L=d[0],p=d[d.length-1];for(y=0;y<d.length;y+=1)U(d[y],P,t);for(y=0;y<b.length;y+=1)h.delete(b[y]);D(e,L.prev,p.next),D(e,f,L),D(e,p,P),u=P,f=p,i-=1,d=[],b=[]}else h.delete(a),U(a,u,t),D(e,a.prev,a.next),D(e,a,f===null?e.effect.first:f.next),D(e,f,a),f=a;continue}for(d=[],b=[];u!==null&&u!==a;)(h??(h=new Set)).add(u),b.push(u),u=u.next;if(u===null)continue}(a.f&M)===0&&d.push(a),f=a,u=a.next}if(e.outrogroups!==null){for(const C of e.outrogroups)C.pending.size===0&&(te(ne(C.done)),(oe=e.outrogroups)==null||oe.delete(C));e.outrogroups.size===0&&(e.outrogroups=null)}if(u!==null||h!==void 0){var v=[];if(h!==void 0)for(a of h)(a.f&ee)===0&&v.push(a);for(;u!==null;)(u.f&ee)===0&&u!==e.fallback&&v.push(u),u=u.next;var E=v.length;if(E>0){var H=(n&Se)!==0&&c===0?t:null;if(s){for(i=0;i<E;i+=1)(ce=(ue=v[i].nodes)==null?void 0:ue.a)==null||ce.measure();for(i=0;i<E;i+=1)(le=(fe=v[i].nodes)==null?void 0:fe.a)==null||le.fix()}gr(e,v,H)}}s&&Ee(()=>{var C,de;if(O!==void 0)for(a of O)(de=(C=a.nodes)==null?void 0:C.a)==null||de.apply()})}function pr(e,r,t,n,o,s,c,g){var u=(c&qe)!==0?(c&Ye)===0?Je(t,!1,!1):ge(t):null,h=(c&Ue)!==0?ge(o):null;return be&&u&&(u.trace=()=>{g()[(h==null?void 0:h.v)??o]}),{v:u,i:h,e:B(()=>(s(r,u??t,h??o,g),()=>{e.delete(n)}))}}function U(e,r,t){if(e.nodes)for(var n=e.nodes.start,o=e.nodes.end,s=r&&(r.f&M)===0?r.nodes.start:t;n!==null;){var c=Ve(n);if(s.before(n),n===o)return;n=c}}function D(e,r,t){r===null?e.effect.first=t:r.next=t,t===null?e.effect.last=r:t.prev=r}function _r(e,r){var t=void 0,n;Oe(()=>{t!==(t=r())&&(n&&(K(n),n=null),t&&(n=B(()=>{se(()=>t(e))})))})}function Sr(e,r,t,n,o,s){var c=e.__className;if(N||c!==t||c===void 0){var g=dr(t,n,s);(!N||g!==e.getAttribute("class"))&&(g==null?e.removeAttribute("class"):r?e.className=g:e.setAttribute("class",g)),e.__className=t}else if(s&&o!==s)for(var u in s){var h=!!s[u];(o==null||h!==!!o[u])&&e.classList.toggle(u,h)}return s}function re(e,r={},t,n){for(var o in t){var s=t[o];r[o]!==s&&(t[o]==null?e.style.removeProperty(o):e.style.setProperty(o,s,n))}}function br(e,r,t,n){var o=e.__style;if(N||o!==r){var s=hr(r,n);(!N||s!==e.getAttribute("style"))&&(s==null?e.removeAttribute("style"):e.style.cssText=s),e.__style=r}else n&&(Array.isArray(n)?(re(e,t==null?void 0:t[0],n[0]),re(e,t==null?void 0:t[1],n[1],"important")):re(e,t,n));return n}function j(e,r,t=!1){if(e.multiple){if(r==null)return;if(!me(r))return Ke();for(var n of e.options)n.selected=r.includes(z(n));return}for(n of e.options){var o=z(n);if(je(o,r)){n.selected=!0;return}}(!t||r!==void 0)&&(e.selectedIndex=-1)}function Pe(e){var r=new MutationObserver(()=>{j(e,e.__value)});r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ge(()=>{r.disconnect()})}function zr(e,r,t=r){var n=new WeakSet,o=!0;We(e,"change",s=>{var c=s?"[selected]":":checked",g;if(e.multiple)g=[].map.call(e.querySelectorAll(c),z);else{var u=e.querySelector(c)??e.querySelector("option:not([disabled])");g=u&&z(u)}t(g),G!==null&&n.add(G)}),se(()=>{var s=r();if(e===document.activeElement){var c=Xe??G;if(n.has(c))return}if(j(e,s,o),o&&s===void 0){var g=e.querySelector(":checked");g!==null&&(s=z(g),t(s))}e.__value=s,o=!1}),Pe(e)}function z(e){return"__value"in e?e.__value:e.value}const J=Symbol("class"),q=Symbol("style"),we=Symbol("is custom element"),ke=Symbol("is html");function mr(e){if(N){var r=!1,t=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var n=e.value;X(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var o=e.checked;X(e,"checked",null),e.checked=o}}};e.__on_r=t,Ee(t),tr()}}function Br(e,r){var t=Z(e);t.value===(t.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!=="PROGRESS")||(e.value=r??"")}function Wr(e,r){var t=Z(e);t.checked!==(t.checked=r??void 0)&&(e.checked=r)}function Ar(e,r){r?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function X(e,r,t,n){var o=Z(e);if(N&&(o[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName==="LINK")){n||Er(e,r,t??"");return}o[r]!==(o[r]=t)&&(r==="loading"&&(e[nr]=t),t==null?e.removeAttribute(r):typeof t!="string"&&Ne(e).includes(r)?e[r]=t:e.setAttribute(r,t))}function Tr(e,r,t,n,o=!1,s=!1){if(N&&o&&e.tagName==="INPUT"){var c=e,g=c.type==="checkbox"?"defaultChecked":"defaultValue";g in t||mr(c)}var u=Z(e),h=u[we],f=!u[ke];let O=N&&h;O&&V(!1);var d=r||{},b=e.tagName==="OPTION";for(var T in r)T in t||(t[T]=null);t.class?t.class=vr(t.class):t[J]&&(t.class=null),t[q]&&(t.style??(t.style=null));var w=Ne(e);for(const p in t){let v=t[p];if(b&&p==="value"&&v==null){e.value=e.__value="",d[p]=v;continue}if(p==="class"){var a=e.namespaceURI==="http://www.w3.org/1999/xhtml";Sr(e,a,v,n,r==null?void 0:r[J],t[J]),d[p]=v,d[J]=t[J];continue}if(p==="style"){br(e,v,r==null?void 0:r[q],t[q]),d[p]=v,d[q]=t[q];continue}var i=d[p];if(!(v===i&&!(v===void 0&&e.hasAttribute(p)))){d[p]=v;var m=p[0]+p[1];if(m!=="$$")if(m==="on"){const E={},H="$$"+p;let _=p.slice(2);var P=lr(_);if(or(_)&&(_=_.slice(0,-7),E.capture=!0),!P&&i){if(v!=null)continue;e.removeEventListener(_,d[H],E),d[H]=null}if(v!=null)if(P)e[`__${_}`]=v,cr([_]);else{let $=function(F){d[p].call(this,F)};d[H]=ur(_,e,$,E)}else P&&(e[`__${_}`]=void 0)}else if(p==="style")X(e,p,v);else if(p==="autofocus")er(e,!!v);else if(!h&&(p==="__value"||p==="value"&&v!=null))e.value=e.__value=v;else if(p==="selected"&&b)Ar(e,v);else{var y=p;f||(y=fr(y));var L=y==="defaultValue"||y==="defaultChecked";if(v==null&&!h&&!L)if(u[p]=null,y==="value"||y==="checked"){let E=e;const H=r===void 0;if(y==="value"){let _=E.defaultValue;E.removeAttribute(y),E.defaultValue=_,E.value=E.__value=H?_:null}else{let _=E.defaultChecked;E.removeAttribute(y),E.defaultChecked=_,E.checked=H?_:!1}}else e.removeAttribute(p);else L||w.includes(y)&&(h||typeof v!="string")?(e[y]=v,y in u&&(u[y]=rr)):typeof v!="function"&&X(e,y,v,s)}}}return O&&V(!0),d}function Gr(e,r,t=[],n=[],o=[],s,c=!1,g=!1){Ze(o,t,n,u=>{var h=void 0,f={},O=e.nodeName==="SELECT",d=!1;if(Oe(()=>{var T=r(...u.map(S)),w=Tr(e,h,T,s,c,g);d&&O&&"value"in T&&j(e,T.value);for(let i of Object.getOwnPropertySymbols(f))T[i]||K(f[i]);for(let i of Object.getOwnPropertySymbols(T)){var a=T[i];i.description===xe&&(!h||a!==h[i])&&(f[i]&&K(f[i]),f[i]=B(()=>_r(e,()=>a))),w[i]=a}h=w}),O){var b=e;se(()=>{j(b,h.value,!0),Pe(b)})}d=!0})}function Z(e){return e.__attributes??(e.__attributes={[we]:e.nodeName.includes("-"),[ke]:e.namespaceURI===Qe})}var pe=new Map;function Ne(e){var r=e.getAttribute("is")||e.nodeName,t=pe.get(r);if(t)return t;pe.set(r,t=[]);for(var n,o=e,s=Element.prototype;s!==o;){n=ir(o);for(var c in n)n[c].set&&t.push(c);o=ar(o)}return t}function Er(e,r,t){be&&(r==="srcset"&&Or(e,t)||ae(e.getAttribute(r)??"",t)||sr(r,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(t)))}function ae(e,r){return e===r?!0:new URL(e,document.baseURI).href===new URL(r,document.baseURI).href}function _e(e){return e.split(",").map(r=>r.trim().split(" ").filter(Boolean))}function Or(e,r){var t=_e(e.srcset),n=_e(r);return n.length===t.length&&n.every(([o,s],c)=>s===t[c][1]&&(ae(t[c][0],o)||ae(o,t[c][0])))}const Pr="/api";async function l(e,r){const t=await fetch(`${Pr}${e}`,{...r,headers:{"Content-Type":"application/json",...r==null?void 0:r.headers}});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}async function wr(){return l("/xiaomi")}async function Kr(e){return l(`/xiaomi/${e}/status`)}async function jr(e,r){return l(`/xiaomi/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function kr(){return l("/roborock/status")}async function Xr(e){return l("/roborock/command",{method:"POST",body:JSON.stringify({cmd:e})})}async function Zr(){return l("/roborock/rooms")}async function Qr(){return l("/roborock/volume")}async function xr(e){return l("/roborock/volume",{method:"POST",body:JSON.stringify({volume:e})})}async function et(e){return l("/roborock/fan-speed",{method:"POST",body:JSON.stringify({mode:e})})}async function rt(e){return l("/roborock/mop-mode",{method:"POST",body:JSON.stringify({mode:e})})}async function tt(e){return l("/roborock/clean-segments",{method:"POST",body:JSON.stringify({segments:e})})}async function at(){return l("/roborock/consumables")}async function nt(e){return l("/roborock/reset-consumable",{method:"POST",body:JSON.stringify({consumable:e})})}async function st(){return l("/presets")}async function it(e){return l(`/presets/${e}/apply`,{method:"POST"})}async function Nr(){return l("/schedules")}async function ot(e,r,t){return l("/schedules",{method:"POST",body:JSON.stringify({name:e,preset:r,time:t})})}async function ut(e){return l(`/schedules/${e}`,{method:"DELETE"})}async function ct(e){return l(`/schedules/${e}/toggle`,{method:"PATCH"})}async function Hr(){return l("/pending-actions")}async function ft(){return l("/pending-actions",{method:"DELETE"})}async function Ir(e=!1){return l(`/devices${e?"?refresh=true":""}`)}async function Lr(){return l("/yamaha")}async function lt(e){return l(`/yamaha/${e}/status`)}async function dt(e,r){return l(`/yamaha/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function Cr(){return l("/purifier/status")}async function ht(e){return l("/purifier/control",{method:"POST",body:JSON.stringify(e)})}async function Rr(){return l("/heater-presets")}async function vt(e,r){return l(`/heater-presets/${e}`,{method:"PATCH",body:JSON.stringify({target_temp:r})})}async function gt(e){return l(`/heater-presets/${e}/apply`,{method:"POST"})}async function yt(e,r,t){return l("/heater-presets",{method:"POST",body:JSON.stringify({id:e,name:r,target_temp:t})})}async function pt(e){return l(`/heater-presets/${e}`,{method:"DELETE"})}async function Mr(){return l("/heater-schedules")}async function _t(e,r,t){return l("/heater-schedules",{method:"POST",body:JSON.stringify({name:e,preset_id:r,time:t})})}async function St(e){return l(`/heater-schedules/${e}`,{method:"DELETE"})}async function bt(e){return l(`/heater-schedules/${e}/toggle`,{method:"PATCH"})}async function Dr(){return l("/pending-heater-actions")}async function mt(){return l("/pending-heater-actions",{method:"DELETE"})}async function $r(){return l("/heater-override")}async function At(e,r,t){return l("/heater-override",{method:"POST",body:JSON.stringify({enabled:e,mode:r,fixed_temp:t})})}let I=null,Y=1e3;function Fr(){let e=k(R([])),r=k(R(new Map)),t=k(null),n=k(R([])),o=k(R([])),s=k(R([])),c=k(R([])),g=k(null),u=k(R([])),h=k(R([])),f=k(R([])),O=k(null),d=k(!1),b=null,T=k(!1);function w(){if((I==null?void 0:I.readyState)===WebSocket.OPEN)return;const a=location.protocol==="https:"?"wss:":"ws:";I=new WebSocket(`${a}//${location.host}/ws`),I.onopen=()=>{console.log("WebSocket connected"),A(T,!0),Y=1e3},I.onclose=()=>{console.log(`WebSocket disconnected, reconnecting in ${Y}ms`),A(T,!1),setTimeout(w,Y),Y=Math.min(Y*2,3e4)},I.onerror=()=>{I==null||I.close()},I.onmessage=i=>{try{const m=JSON.parse(i.data);if(m.type==="lamp_status"&&m.deviceId&&m.status){const P=new Map(S(r));P.set(m.deviceId,m.status),A(r,P,!0),A(e,S(e).map(y=>y.id===m.deviceId?{...y,online:1}:y),!0)}else if(m.type==="lamp_offline"&&m.deviceId){const P=new Map(S(r));P.delete(m.deviceId),A(r,P,!0),A(e,S(e).map(y=>y.id===m.deviceId?{...y,online:0}:y),!0)}}catch{}}}return{get lamps(){return S(e)},get lampStatuses(){return S(r)},get roborock(){return S(t)},get schedules(){return S(n)},get pendingActions(){return S(o)},get tuyaDevices(){return S(s)},get yamahaDevices(){return S(c)},get airPurifier(){return S(g)},get heaterPresets(){return S(u)},get heaterSchedules(){return S(h)},get pendingHeaterActions(){return S(f)},get heaterOverride(){return S(O)},get loading(){return S(d)},get error(){return b},get wsConnected(){return S(T)},initWebSocket(){w()},updateLampStatus(a,i){const m=new Map(S(r));m.set(a,i),A(r,m,!0)},async refreshLamps(){try{A(e,await wr(),!0);const a=new Map(S(r));for(const i of S(e))if(i.last_status)try{a.set(i.id,JSON.parse(i.last_status))}catch{}A(r,a,!0)}catch(a){console.error("Failed to fetch lamps:",a)}},async refreshRoborock(){try{A(t,await kr(),!0)}catch{A(t,null)}},async refreshSchedules(){try{A(n,await Nr(),!0)}catch(a){console.error("Failed to fetch schedules:",a)}},async refreshPending(){try{A(o,await Hr(),!0)}catch(a){console.error("Failed to fetch pending actions:",a)}},async refreshTuya(a=!0){try{A(s,await Ir(a),!0)}catch(i){console.error("Failed to fetch Tuya devices:",i)}},async refreshYamaha(){try{A(c,await Lr(),!0)}catch(a){console.error("Failed to fetch Yamaha devices:",a)}},async refreshAirPurifier(){try{A(g,await Cr(),!0)}catch{A(g,null)}},async refreshHeaterPresets(){try{A(u,await Rr(),!0)}catch(a){console.error("Failed to fetch heater presets:",a)}},async refreshHeaterSchedules(){try{A(h,await Mr(),!0)}catch(a){console.error("Failed to fetch heater schedules:",a)}},async refreshPendingHeater(){try{A(f,await Dr(),!0)}catch(a){console.error("Failed to fetch pending heater actions:",a)}},async refreshHeaterOverride(){try{A(O,await $r(),!0)}catch(a){console.error("Failed to fetch heater override:",a)}},async refreshAll(){A(d,!0),await Promise.all([this.refreshLamps(),this.refreshRoborock(),this.refreshSchedules(),this.refreshPending(),this.refreshTuya(),this.refreshYamaha(),this.refreshAirPurifier(),this.refreshHeaterPresets(),this.refreshHeaterSchedules(),this.refreshPendingHeater(),this.refreshHeaterOverride()]),A(d,!1)}}}const Tt=Fr();export{Br as A,Zr as B,Qr as C,at as D,Xr as E,et as F,rt as G,br as H,tt as I,nt as J,xr as K,lt as L,dt as M,ht as N,Sr as a,zr as b,ot as c,ut as d,Vr as e,ft as f,it as g,st as h,Gr as i,Ur as j,At as k,_t as l,Wr as m,yt as n,pt as o,gt as p,bt as q,mr as r,Tt as s,ct as t,vt as u,St as v,mt as w,X as x,jr as y,Kr as z};
