import{F as H,n as ie,M as Y,B as x,G as ue,O as fe,b as S,a as ce,Q as le,R as de,T as ee,K as V,N as $,I as he,al as ge,am as re,y as ve,an as E,X as z,Z as pe,D as me,v as ye,ao as ne,ap as U,ab as Se,aq as be,ar as Te,as as _e,U as te,W as se,at as q,J as Ee,au as ke,V as Oe,av as oe,ae as Pe,aw as we,a3 as k,c as L,s as T}from"./CKtoZ9Il.js";function Ye(e,a){return a}function Ae(e,a,t){for(var h=[],g=a.length,f,u=a.length,l=0;l<g;l++){let p=a[l];se(p,()=>{if(f){if(f.pending.delete(p),f.done.add(p),f.pending.size===0){var d=e.outrogroups;B(U(f.done)),d.delete(f),d.size===0&&(e.outrogroups=null)}}else u-=1},!1)}if(u===0){var s=h.length===0&&t!==null;if(s){var c=t,n=c.parentNode;ke(n),n.append(c),e.items.clear()}B(a,!s)}else f={pending:new Set(a),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(f)}function B(e,a=!0){for(var t=0;t<e.length;t++)Oe(e[t],a)}var ae;function Ve(e,a,t,h,g,f=null){var u=e,l=new Map,s=(a&oe)!==0;if(s){var c=e;u=x?Y(ue(c)):c.appendChild(H())}x&&fe();var n=null,p=ce(()=>{var o=t();return Se(o)?o:o==null?[]:U(o)}),d,v=!0;function P(){r.fallback=n,Re(r,d,u,a,h),n!==null&&(d.length===0?(n.f&E)===0?te(n):(n.f^=E,M(n,null,u)):se(n,()=>{n=null}))}var R=ie(()=>{d=S(p);var o=d.length;let N=!1;if(x){var C=le(u)===de;C!==(o===0)&&(u=ee(),Y(u),V(!1),N=!0)}for(var b=new Set,w=ve,D=pe(),m=0;m<o;m+=1){x&&$.nodeType===he&&$.data===ge&&(u=$,N=!0,V(!1));var A=d[m],I=h(A,m),y=v?null:l.get(I);y?(y.v&&re(y.v,A),y.i&&re(y.i,m),D&&w.skipped_effects.delete(y.e)):(y=Ne(l,v?u:ae??(ae=H()),A,I,m,g,a,t),v||(y.e.f|=E),l.set(I,y)),b.add(I)}if(o===0&&f&&!n&&(v?n=z(()=>f(u)):(n=z(()=>f(ae??(ae=H()))),n.f|=E)),x&&o>0&&Y(ee()),!v)if(D){for(const[F,J]of l)b.has(F)||w.skipped_effects.add(J.e);w.oncommit(P),w.ondiscard(()=>{})}else P();N&&V(!0),S(p)}),r={effect:R,items:l,outrogroups:null,fallback:n};v=!1,x&&(u=$)}function Re(e,a,t,h,g){var y,F,J,X,G,K,Q,W,Z;var f=(h&we)!==0,u=a.length,l=e.items,s=e.effect.first,c,n=null,p,d=[],v=[],P,R,r,o;if(f)for(o=0;o<u;o+=1)P=a[o],R=g(P,o),r=l.get(R).e,(r.f&E)===0&&((F=(y=r.nodes)==null?void 0:y.a)==null||F.measure(),(p??(p=new Set)).add(r));for(o=0;o<u;o+=1){if(P=a[o],R=g(P,o),r=l.get(R).e,e.outrogroups!==null)for(const _ of e.outrogroups)_.pending.delete(r),_.done.delete(r);if((r.f&E)!==0)if(r.f^=E,r===s)M(r,null,t);else{var N=n?n.next:s;r===e.effect.last&&(e.effect.last=r.prev),r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),O(e,n,r),O(e,r,N),M(r,N,t),n=r,d=[],v=[],s=n.next;continue}if((r.f&q)!==0&&(te(r),f&&((X=(J=r.nodes)==null?void 0:J.a)==null||X.unfix(),(p??(p=new Set)).delete(r))),r!==s){if(c!==void 0&&c.has(r)){if(d.length<v.length){var C=v[0],b;n=C.prev;var w=d[0],D=d[d.length-1];for(b=0;b<d.length;b+=1)M(d[b],C,t);for(b=0;b<v.length;b+=1)c.delete(v[b]);O(e,w.prev,D.next),O(e,n,w),O(e,D,C),s=C,n=D,o-=1,d=[],v=[]}else c.delete(r),M(r,s,t),O(e,r.prev,r.next),O(e,r,n===null?e.effect.first:n.next),O(e,n,r),n=r;continue}for(d=[],v=[];s!==null&&s!==r;)(c??(c=new Set)).add(s),v.push(s),s=s.next;if(s===null)continue}(r.f&E)===0&&d.push(r),n=r,s=r.next}if(e.outrogroups!==null){for(const _ of e.outrogroups)_.pending.size===0&&(B(U(_.done)),(G=e.outrogroups)==null||G.delete(_));e.outrogroups.size===0&&(e.outrogroups=null)}if(s!==null||c!==void 0){var m=[];if(c!==void 0)for(r of c)(r.f&q)===0&&m.push(r);for(;s!==null;)(s.f&q)===0&&s!==e.fallback&&m.push(s),s=s.next;var A=m.length;if(A>0){var I=(h&oe)!==0&&u===0?t:null;if(f){for(o=0;o<A;o+=1)(Q=(K=m[o].nodes)==null?void 0:K.a)==null||Q.measure();for(o=0;o<A;o+=1)(Z=(W=m[o].nodes)==null?void 0:W.a)==null||Z.fix()}Ae(e,m,I)}}f&&Pe(()=>{var _,j;if(p!==void 0)for(r of p)(j=(_=r.nodes)==null?void 0:_.a)==null||j.apply()})}function Ne(e,a,t,h,g,f,u,l){var s=(u&be)!==0?(u&Te)===0?ye(t,!1,!1):ne(t):null,c=(u&_e)!==0?ne(g):null;return me&&s&&(s.trace=()=>{l()[(c==null?void 0:c.v)??g]}),{v:s,i:c,e:z(()=>(f(a,s??t,c??g,l),()=>{e.delete(h)}))}}function M(e,a,t){if(e.nodes)for(var h=e.nodes.start,g=e.nodes.end,f=a&&(a.f&E)===0?a.nodes.start:t;h!==null;){var u=Ee(h);if(f.before(h),h===g)return;h=u}}function O(e,a,t){a===null?e.effect.first=t:a.next=t,t===null?e.effect.last=a:t.prev=a}const Ce="/api";async function i(e,a){const t=await fetch(`${Ce}${e}`,{...a,headers:{"Content-Type":"application/json",...a==null?void 0:a.headers}});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}async function De(){return i("/xiaomi")}async function qe(e){return i(`/xiaomi/${e}/status`)}async function ze(e,a){return i(`/xiaomi/${e}/control`,{method:"POST",body:JSON.stringify(a)})}async function Ie(){return i("/roborock/status")}async function Be(e){return i("/roborock/command",{method:"POST",body:JSON.stringify({cmd:e})})}async function Ue(){return i("/roborock/rooms")}async function Xe(){return i("/roborock/volume")}async function Ge(e){return i("/roborock/volume",{method:"POST",body:JSON.stringify({volume:e})})}async function Ke(e){return i("/roborock/fan-speed",{method:"POST",body:JSON.stringify({mode:e})})}async function Qe(e){return i("/roborock/mop-mode",{method:"POST",body:JSON.stringify({mode:e})})}async function We(e){return i("/roborock/clean-segments",{method:"POST",body:JSON.stringify({segments:e})})}async function Ze(){return i("/roborock/consumables")}async function je(e){return i("/roborock/reset-consumable",{method:"POST",body:JSON.stringify({consumable:e})})}async function er(){return i("/presets")}async function rr(e){return i(`/presets/${e}/apply`,{method:"POST"})}async function xe(){return i("/schedules")}async function nr(e,a,t){return i("/schedules",{method:"POST",body:JSON.stringify({name:e,preset:a,time:t})})}async function ar(e){return i(`/schedules/${e}`,{method:"DELETE"})}async function tr(e){return i(`/schedules/${e}/toggle`,{method:"PATCH"})}async function Le(){return i("/pending-actions")}async function sr(){return i("/pending-actions",{method:"DELETE"})}async function Me(){return i("/devices")}async function Fe(){return i("/yamaha")}async function or(e){return i(`/yamaha/${e}/status`)}async function ir(e,a){return i(`/yamaha/${e}/control`,{method:"POST",body:JSON.stringify(a)})}async function Je(){return i("/purifier/status")}async function ur(e){return i("/purifier/control",{method:"POST",body:JSON.stringify(e)})}function $e(){let e=k(L([])),a=L(new Map),t=k(null),h=k(L([])),g=k(L([])),f=k(L([])),u=k(L([])),l=k(null),s=k(!1),c=null;return{get lamps(){return S(e)},get lampStatuses(){return a},get roborock(){return S(t)},get schedules(){return S(h)},get pendingActions(){return S(g)},get tuyaDevices(){return S(f)},get yamahaDevices(){return S(u)},get airPurifier(){return S(l)},get loading(){return S(s)},get error(){return c},updateLampStatus(n,p){a.set(n,p)},async refreshLamps(){try{T(e,await De(),!0),console.log("Refreshed lamps:",S(e).length,S(e))}catch(n){console.error("Failed to fetch lamps:",n)}},async refreshRoborock(){try{T(t,await Ie(),!0)}catch{T(t,null)}},async refreshSchedules(){try{T(h,await xe(),!0)}catch(n){console.error("Failed to fetch schedules:",n)}},async refreshPending(){try{T(g,await Le(),!0)}catch(n){console.error("Failed to fetch pending actions:",n)}},async refreshTuya(){try{T(f,await Me(),!0)}catch(n){console.error("Failed to fetch Tuya devices:",n)}},async refreshYamaha(){try{T(u,await Fe(),!0)}catch(n){console.error("Failed to fetch Yamaha devices:",n)}},async refreshAirPurifier(){try{T(l,await Je(),!0)}catch{T(l,null)}},async refreshAll(){T(s,!0),await Promise.all([this.refreshLamps(),this.refreshRoborock(),this.refreshSchedules(),this.refreshPending(),this.refreshTuya(),this.refreshYamaha(),this.refreshAirPurifier()]),T(s,!1)}}}const fr=$e();export{rr as a,sr as b,nr as c,ar as d,Ve as e,qe as f,er as g,ze as h,Ye as i,Ue as j,Xe as k,Ze as l,Be as m,Ke as n,Qe as o,Ge as p,We as q,je as r,fr as s,tr as t,or as u,ir as v,ur as w};
