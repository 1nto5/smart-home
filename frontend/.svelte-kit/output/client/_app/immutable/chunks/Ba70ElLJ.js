import{w as j,b as Ie,aq as Se,A as Q,h as N,x as He,a as Ce,g as m,V as Le,F as Re,G as Me,I as he,z as V,B as W,C as De,ar as $e,as as ve,n as G,at as M,an as B,ap as Fe,D as be,N as Je,P as ge,au as ae,av as me,aw as qe,ax as Ye,ay as Ue,ak as Ae,am as Te,az as x,q as Ee,y as Ve,aA as ze,aB as Be,al as K,aC as we,e as ne,l as We,K as Ge,aD as Ke,aE as Xe,v as Ze,aF as je,aG as Qe,aH as xe,aI as er,aJ as rr,aK as tr,aL as ar,aM as nr,aN as sr,aO as ir,d as I,W as R,j as A}from"./js2fU5d7.js";import{g as or,h as ur,d as cr,n as fr,j as lr}from"./1jsiGTgY.js";import{t as dr,a as hr,c as vr}from"./CFFBHRKH.js";function Yr(e,r){return r}function gr(e,r,t){for(var n=[],o=r.length,i,c=r.length,y=0;y<o;y++){let T=r[y];Te(T,()=>{if(i){if(i.pending.delete(T),i.done.add(T),i.pending.size===0){var d=e.outrogroups;re(ae(i.done)),d.delete(i),d.size===0&&(e.outrogroups=null)}}else c-=1},!1)}if(c===0){var u=n.length===0&&t!==null;if(u){var l=t,f=l.parentNode;Be(f),f.append(l),e.items.clear()}re(r,!u)}else i={pending:new Set(r),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(i)}function re(e,r=!0){for(var t=0;t<e.length;t++)K(e[t],r)}var ye;function Ur(e,r,t,n,o,i=null){var c=e,y=new Map,u=(r&Se)!==0;if(u){var l=e;c=N?Q(He(l)):l.appendChild(j())}N&&Ce();var f=null,T=Le(()=>{var s=t();return me(s)?s:s==null?[]:ae(s)}),d,b=!0;function w(){a.fallback=f,yr(a,d,c,r,n),f!==null&&(d.length===0?(f.f&M)===0?Ae(f):(f.f^=M,U(f,null,c)):Te(f,()=>{f=null}))}var h=Ie(()=>{d=m(T);var s=d.length;let k=!1;if(N){var P=Re(c)===Me;P!==(s===0)&&(c=he(),Q(c),V(!1),k=!0)}for(var S=new Set,C=G,p=Fe(),v=0;v<s;v+=1){N&&W.nodeType===De&&W.data===$e&&(c=W,k=!0,V(!1));var E=d[v],O=n(E,v),_=b?null:y.get(O);_?(_.v&&ve(_.v,E),_.i&&ve(_.i,v),p&&C.skipped_effects.delete(_.e)):(_=pr(y,b?c:ye??(ye=j()),E,O,v,o,r,t),b||(_.e.f|=M),y.set(O,_)),S.add(O)}if(s===0&&i&&!f&&(b?f=B(()=>i(c)):(f=B(()=>i(ye??(ye=j()))),f.f|=M)),N&&s>0&&Q(he()),!b)if(p){for(const[$,F]of y)S.has($)||C.skipped_effects.add(F.e);C.oncommit(w),C.ondiscard(()=>{})}else w();k&&V(!0),m(T)}),a={effect:h,items:y,outrogroups:null,fallback:f};b=!1,N&&(c=W)}function yr(e,r,t,n,o){var _,$,F,ie,oe,ue,ce,fe,le;var i=(n&ze)!==0,c=r.length,y=e.items,u=e.effect.first,l,f=null,T,d=[],b=[],w,h,a,s;if(i)for(s=0;s<c;s+=1)w=r[s],h=o(w,s),a=y.get(h).e,(a.f&M)===0&&(($=(_=a.nodes)==null?void 0:_.a)==null||$.measure(),(T??(T=new Set)).add(a));for(s=0;s<c;s+=1){if(w=r[s],h=o(w,s),a=y.get(h).e,e.outrogroups!==null)for(const L of e.outrogroups)L.pending.delete(a),L.done.delete(a);if((a.f&M)!==0)if(a.f^=M,a===u)U(a,null,t);else{var k=f?f.next:u;a===e.effect.last&&(e.effect.last=a.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),D(e,f,a),D(e,a,k),U(a,k,t),f=a,d=[],b=[],u=f.next;continue}if((a.f&x)!==0&&(Ae(a),i&&((ie=(F=a.nodes)==null?void 0:F.a)==null||ie.unfix(),(T??(T=new Set)).delete(a))),a!==u){if(l!==void 0&&l.has(a)){if(d.length<b.length){var P=b[0],S;f=P.prev;var C=d[0],p=d[d.length-1];for(S=0;S<d.length;S+=1)U(d[S],P,t);for(S=0;S<b.length;S+=1)l.delete(b[S]);D(e,C.prev,p.next),D(e,f,C),D(e,p,P),u=P,f=p,s-=1,d=[],b=[]}else l.delete(a),U(a,u,t),D(e,a.prev,a.next),D(e,a,f===null?e.effect.first:f.next),D(e,f,a),f=a;continue}for(d=[],b=[];u!==null&&u!==a;)(l??(l=new Set)).add(u),b.push(u),u=u.next;if(u===null)continue}(a.f&M)===0&&d.push(a),f=a,u=a.next}if(e.outrogroups!==null){for(const L of e.outrogroups)L.pending.size===0&&(re(ae(L.done)),(oe=e.outrogroups)==null||oe.delete(L));e.outrogroups.size===0&&(e.outrogroups=null)}if(u!==null||l!==void 0){var v=[];if(l!==void 0)for(a of l)(a.f&x)===0&&v.push(a);for(;u!==null;)(u.f&x)===0&&u!==e.fallback&&v.push(u),u=u.next;var E=v.length;if(E>0){var O=(n&Se)!==0&&c===0?t:null;if(i){for(s=0;s<E;s+=1)(ce=(ue=v[s].nodes)==null?void 0:ue.a)==null||ce.measure();for(s=0;s<E;s+=1)(le=(fe=v[s].nodes)==null?void 0:fe.a)==null||le.fix()}gr(e,v,O)}}i&&Ee(()=>{var L,de;if(T!==void 0)for(a of T)(de=(L=a.nodes)==null?void 0:L.a)==null||de.apply()})}function pr(e,r,t,n,o,i,c,y){var u=(c&qe)!==0?(c&Ye)===0?Je(t,!1,!1):ge(t):null,l=(c&Ue)!==0?ge(o):null;return be&&u&&(u.trace=()=>{y()[(l==null?void 0:l.v)??o]}),{v:u,i:l,e:B(()=>(i(r,u??t,l??o,y),()=>{e.delete(n)}))}}function U(e,r,t){if(e.nodes)for(var n=e.nodes.start,o=e.nodes.end,i=r&&(r.f&M)===0?r.nodes.start:t;n!==null;){var c=Ve(n);if(i.before(n),n===o)return;n=c}}function D(e,r,t){r===null?e.effect.first=t:r.next=t,t===null?e.effect.last=r:t.prev=r}function _r(e,r){var t=void 0,n;we(()=>{t!==(t=r())&&(n&&(K(n),n=null),t&&(n=B(()=>{ne(()=>t(e))})))})}function Sr(e,r,t,n,o,i){var c=e.__className;if(N||c!==t||c===void 0){var y=dr(t,n,i);(!N||y!==e.getAttribute("class"))&&(y==null?e.removeAttribute("class"):r?e.className=y:e.setAttribute("class",y)),e.__className=t}else if(i&&o!==i)for(var u in i){var l=!!i[u];(o==null||l!==!!o[u])&&e.classList.toggle(u,l)}return i}function ee(e,r={},t,n){for(var o in t){var i=t[o];r[o]!==i&&(t[o]==null?e.style.removeProperty(o):e.style.setProperty(o,i,n))}}function br(e,r,t,n){var o=e.__style;if(N||o!==r){var i=hr(r,n);(!N||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=r}else n&&(Array.isArray(n)?(ee(e,t==null?void 0:t[0],n[0]),ee(e,t==null?void 0:t[1],n[1],"important")):ee(e,t,n));return n}function X(e,r,t=!1){if(e.multiple){if(r==null)return;if(!me(r))return Ke();for(var n of e.options)n.selected=r.includes(z(n));return}for(n of e.options){var o=z(n);if(Xe(o,r)){n.selected=!0;return}}(!t||r!==void 0)&&(e.selectedIndex=-1)}function Pe(e){var r=new MutationObserver(()=>{X(e,e.__value)});r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ge(()=>{r.disconnect()})}function Vr(e,r,t=r){var n=new WeakSet,o=!0;We(e,"change",i=>{var c=i?"[selected]":":checked",y;if(e.multiple)y=[].map.call(e.querySelectorAll(c),z);else{var u=e.querySelector(c)??e.querySelector("option:not([disabled])");y=u&&z(u)}t(y),G!==null&&n.add(G)}),ne(()=>{var i=r();if(e===document.activeElement){var c=Ze??G;if(n.has(c))return}if(X(e,i,o),o&&i===void 0){var y=e.querySelector(":checked");y!==null&&(i=z(y),t(i))}e.__value=i,o=!1}),Pe(e)}function z(e){return"__value"in e?e.__value:e.value}const J=Symbol("class"),q=Symbol("style"),ke=Symbol("is custom element"),Ne=Symbol("is html");function mr(e){if(N){var r=!1,t=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var n=e.value;Z(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var o=e.checked;Z(e,"checked",null),e.checked=o}}};e.__on_r=t,Ee(t),rr()}}function zr(e,r){var t=se(e);t.value===(t.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!=="PROGRESS")||(e.value=r??"")}function Ar(e,r){r?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Z(e,r,t,n){var o=se(e);if(N&&(o[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName==="LINK")){n||Er(e,r,t??"");return}o[r]!==(o[r]=t)&&(r==="loading"&&(e[nr]=t),t==null?e.removeAttribute(r):typeof t!="string"&&Oe(e).includes(r)?e[r]=t:e.setAttribute(r,t))}function Tr(e,r,t,n,o=!1,i=!1){if(N&&o&&e.tagName==="INPUT"){var c=e,y=c.type==="checkbox"?"defaultChecked":"defaultValue";y in t||mr(c)}var u=se(e),l=u[ke],f=!u[Ne];let T=N&&l;T&&V(!1);var d=r||{},b=e.tagName==="OPTION";for(var w in r)w in t||(t[w]=null);t.class?t.class=vr(t.class):t[J]&&(t.class=null),t[q]&&(t.style??(t.style=null));var h=Oe(e);for(const p in t){let v=t[p];if(b&&p==="value"&&v==null){e.value=e.__value="",d[p]=v;continue}if(p==="class"){var a=e.namespaceURI==="http://www.w3.org/1999/xhtml";Sr(e,a,v,n,r==null?void 0:r[J],t[J]),d[p]=v,d[J]=t[J];continue}if(p==="style"){br(e,v,r==null?void 0:r[q],t[q]),d[p]=v,d[q]=t[q];continue}var s=d[p];if(!(v===s&&!(v===void 0&&e.hasAttribute(p)))){d[p]=v;var k=p[0]+p[1];if(k!=="$$")if(k==="on"){const E={},O="$$"+p;let _=p.slice(2);var P=lr(_);if(or(_)&&(_=_.slice(0,-7),E.capture=!0),!P&&s){if(v!=null)continue;e.removeEventListener(_,d[O],E),d[O]=null}if(v!=null)if(P)e[`__${_}`]=v,cr([_]);else{let $=function(F){d[p].call(this,F)};d[O]=ur(_,e,$,E)}else P&&(e[`__${_}`]=void 0)}else if(p==="style")Z(e,p,v);else if(p==="autofocus")xe(e,!!v);else if(!l&&(p==="__value"||p==="value"&&v!=null))e.value=e.__value=v;else if(p==="selected"&&b)Ar(e,v);else{var S=p;f||(S=fr(S));var C=S==="defaultValue"||S==="defaultChecked";if(v==null&&!l&&!C)if(u[p]=null,S==="value"||S==="checked"){let E=e;const O=r===void 0;if(S==="value"){let _=E.defaultValue;E.removeAttribute(S),E.defaultValue=_,E.value=E.__value=O?_:null}else{let _=E.defaultChecked;E.removeAttribute(S),E.defaultChecked=_,E.checked=O?_:!1}}else e.removeAttribute(p);else C||h.includes(S)&&(l||typeof v!="string")?(e[S]=v,S in u&&(u[S]=er)):typeof v!="function"&&Z(e,S,v,i)}}}return T&&V(!0),d}function Br(e,r,t=[],n=[],o=[],i,c=!1,y=!1){je(o,t,n,u=>{var l=void 0,f={},T=e.nodeName==="SELECT",d=!1;if(we(()=>{var w=r(...u.map(m)),h=Tr(e,l,w,i,c,y);d&&T&&"value"in w&&X(e,w.value);for(let s of Object.getOwnPropertySymbols(f))w[s]||K(f[s]);for(let s of Object.getOwnPropertySymbols(w)){var a=w[s];s.description===Qe&&(!l||a!==l[s])&&(f[s]&&K(f[s]),f[s]=B(()=>_r(e,()=>a))),h[s]=a}l=h}),T){var b=e;ne(()=>{X(b,l.value,!0),Pe(b)})}d=!0})}function se(e){return e.__attributes??(e.__attributes={[ke]:e.nodeName.includes("-"),[Ne]:e.namespaceURI===tr})}var pe=new Map;function Oe(e){var r=e.getAttribute("is")||e.nodeName,t=pe.get(r);if(t)return t;pe.set(r,t=[]);for(var n,o=e,i=Element.prototype;i!==o;){n=ir(o);for(var c in n)n[c].set&&t.push(c);o=ar(o)}return t}function Er(e,r,t){be&&(r==="srcset"&&wr(e,t)||te(e.getAttribute(r)??"",t)||sr(r,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(t)))}function te(e,r){return e===r?!0:new URL(e,document.baseURI).href===new URL(r,document.baseURI).href}function _e(e){return e.split(",").map(r=>r.trim().split(" ").filter(Boolean))}function wr(e,r){var t=_e(e.srcset),n=_e(r);return n.length===t.length&&n.every(([o,i],c)=>i===t[c][1]&&(te(t[c][0],o)||te(o,t[c][0])))}const Pr="/api";async function g(e,r){const t=await fetch(`${Pr}${e}`,{...r,headers:{"Content-Type":"application/json",...r==null?void 0:r.headers}});if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}async function kr(){return g("/xiaomi")}async function Wr(e){return g(`/xiaomi/${e}/status`)}async function Gr(e,r){return g(`/xiaomi/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function Nr(){return g("/roborock/status")}async function Kr(e){return g("/roborock/command",{method:"POST",body:JSON.stringify({cmd:e})})}async function Xr(){return g("/roborock/rooms")}async function Zr(){return g("/roborock/volume")}async function jr(e){return g("/roborock/volume",{method:"POST",body:JSON.stringify({volume:e})})}async function Qr(e){return g("/roborock/fan-speed",{method:"POST",body:JSON.stringify({mode:e})})}async function xr(e){return g("/roborock/mop-mode",{method:"POST",body:JSON.stringify({mode:e})})}async function et(e){return g("/roborock/clean-segments",{method:"POST",body:JSON.stringify({segments:e})})}async function rt(){return g("/roborock/consumables")}async function tt(e){return g("/roborock/reset-consumable",{method:"POST",body:JSON.stringify({consumable:e})})}async function at(){return g("/presets")}async function nt(e){return g(`/presets/${e}/apply`,{method:"POST"})}async function Or(){return g("/schedules")}async function st(e,r,t){return g("/schedules",{method:"POST",body:JSON.stringify({name:e,preset:r,time:t})})}async function it(e){return g(`/schedules/${e}`,{method:"DELETE"})}async function ot(e){return g(`/schedules/${e}/toggle`,{method:"PATCH"})}async function Ir(){return g("/pending-actions")}async function ut(){return g("/pending-actions",{method:"DELETE"})}async function Hr(e=!1){return g(`/devices${e?"?refresh=true":""}`)}async function Cr(){return g("/yamaha")}async function ct(e){return g(`/yamaha/${e}/status`)}async function ft(e,r){return g(`/yamaha/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function Lr(){return g("/purifier/status")}async function lt(e){return g("/purifier/control",{method:"POST",body:JSON.stringify(e)})}async function Rr(){return g("/heater-presets")}async function dt(e,r){return g(`/heater-presets/${e}`,{method:"PATCH",body:JSON.stringify({target_temp:r})})}async function ht(e){return g(`/heater-presets/${e}/apply`,{method:"POST"})}async function Mr(){return g("/heater-schedules")}async function vt(e,r,t){return g("/heater-schedules",{method:"POST",body:JSON.stringify({name:e,preset_id:r,time:t})})}async function gt(e){return g(`/heater-schedules/${e}`,{method:"DELETE"})}async function yt(e){return g(`/heater-schedules/${e}/toggle`,{method:"PATCH"})}async function Dr(){return g("/pending-heater-actions")}async function pt(){return g("/pending-heater-actions",{method:"DELETE"})}let H=null,Y=1e3;function $r(){let e=I(R([])),r=I(R(new Map)),t=I(null),n=I(R([])),o=I(R([])),i=I(R([])),c=I(R([])),y=I(null),u=I(R([])),l=I(R([])),f=I(R([])),T=I(!1),d=null,b=I(!1);function w(){if((H==null?void 0:H.readyState)===WebSocket.OPEN)return;const h=location.protocol==="https:"?"wss:":"ws:";H=new WebSocket(`${h}//${location.host}/ws`),H.onopen=()=>{console.log("WebSocket connected"),A(b,!0),Y=1e3},H.onclose=()=>{console.log(`WebSocket disconnected, reconnecting in ${Y}ms`),A(b,!1),setTimeout(w,Y),Y=Math.min(Y*2,3e4)},H.onerror=()=>{H==null||H.close()},H.onmessage=a=>{try{const s=JSON.parse(a.data);if(s.type==="lamp_status"&&s.deviceId&&s.status){const k=new Map(m(r));k.set(s.deviceId,s.status),A(r,k,!0),A(e,m(e).map(P=>P.id===s.deviceId?{...P,online:1}:P),!0)}else if(s.type==="lamp_offline"&&s.deviceId){const k=new Map(m(r));k.delete(s.deviceId),A(r,k,!0),A(e,m(e).map(P=>P.id===s.deviceId?{...P,online:0}:P),!0)}}catch{}}}return{get lamps(){return m(e)},get lampStatuses(){return m(r)},get roborock(){return m(t)},get schedules(){return m(n)},get pendingActions(){return m(o)},get tuyaDevices(){return m(i)},get yamahaDevices(){return m(c)},get airPurifier(){return m(y)},get heaterPresets(){return m(u)},get heaterSchedules(){return m(l)},get pendingHeaterActions(){return m(f)},get loading(){return m(T)},get error(){return d},get wsConnected(){return m(b)},initWebSocket(){w()},updateLampStatus(h,a){const s=new Map(m(r));s.set(h,a),A(r,s,!0)},async refreshLamps(){try{A(e,await kr(),!0);const h=new Map(m(r));for(const a of m(e))if(a.last_status)try{h.set(a.id,JSON.parse(a.last_status))}catch{}A(r,h,!0)}catch(h){console.error("Failed to fetch lamps:",h)}},async refreshRoborock(){try{A(t,await Nr(),!0)}catch{A(t,null)}},async refreshSchedules(){try{A(n,await Or(),!0)}catch(h){console.error("Failed to fetch schedules:",h)}},async refreshPending(){try{A(o,await Ir(),!0)}catch(h){console.error("Failed to fetch pending actions:",h)}},async refreshTuya(h=!0){try{A(i,await Hr(h),!0)}catch(a){console.error("Failed to fetch Tuya devices:",a)}},async refreshYamaha(){try{A(c,await Cr(),!0)}catch(h){console.error("Failed to fetch Yamaha devices:",h)}},async refreshAirPurifier(){try{A(y,await Lr(),!0)}catch{A(y,null)}},async refreshHeaterPresets(){try{A(u,await Rr(),!0)}catch(h){console.error("Failed to fetch heater presets:",h)}},async refreshHeaterSchedules(){try{A(l,await Mr(),!0)}catch(h){console.error("Failed to fetch heater schedules:",h)}},async refreshPendingHeater(){try{A(f,await Dr(),!0)}catch(h){console.error("Failed to fetch pending heater actions:",h)}},async refreshAll(){A(T,!0),await Promise.all([this.refreshLamps(),this.refreshRoborock(),this.refreshSchedules(),this.refreshPending(),this.refreshTuya(),this.refreshYamaha(),this.refreshAirPurifier(),this.refreshHeaterPresets(),this.refreshHeaterSchedules(),this.refreshPendingHeater()]),A(T,!1)}}}const _t=$r();export{Kr as A,Qr as B,xr as C,br as D,et as E,tt as F,jr as G,ct as H,ft as I,lt as J,Sr as a,Vr as b,st as c,it as d,Ur as e,ut as f,nt as g,at as h,vt as i,ht as j,yt as k,gt as l,pt as m,Br as n,Yr as o,Z as p,Gr as q,mr as r,_t as s,ot as t,dt as u,Wr as v,zr as w,Xr as x,Zr as y,rt as z};
