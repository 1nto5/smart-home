import{o as Z,v as Pe,aq as be,z as Q,m as k,w as Ce,B as Le,g as E,a5 as Re,F as Me,G as De,I as ve,y as V,A as W,C as $e,ar as He,as as he,j as G,at as M,am as B,ao as Fe,D as Se,_ as Je,a1 as ge,au as te,av as me,aw as qe,ax as Ye,ay as Ue,aj as Ae,al as Te,az as x,q as Ee,x as Ve,aA as ze,aB as Be,ak as K,aC as ke,e as ne,l as We,Y as Ge,aD as Ke,aE as je,n as Xe,aF as Ze,aG as Qe,aH as xe,aI as er,aJ as rr,aK as ar,aL as tr,aM as nr,aN as sr,aO as ir,a as R,V as F,d as w}from"./DSyWC8IU.js";import{g as or,h as ur,d as fr,n as cr,j as lr}from"./DZ0_ip0j.js";import{t as dr,a as vr,c as hr}from"./CXwYO5u8.js";function Fr(e,r){return r}function gr(e,r,a){for(var t=[],o=r.length,i,f=r.length,h=0;h<o;h++){let A=r[h];Te(A,()=>{if(i){if(i.pending.delete(A),i.done.add(A),i.pending.size===0){var s=e.outrogroups;re(te(i.done)),s.delete(i),s.size===0&&(e.outrogroups=null)}}else f-=1},!1)}if(f===0){var u=t.length===0&&a!==null;if(u){var d=a,l=d.parentNode;Be(l),l.append(d),e.items.clear()}re(r,!u)}else i={pending:new Set(r),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(i)}function re(e,r=!0){for(var a=0;a<e.length;a++)K(e[a],r)}var _e;function Jr(e,r,a,t,o,i=null){var f=e,h=new Map,u=(r&be)!==0;if(u){var d=e;f=k?Q(Ce(d)):d.appendChild(Z())}k&&Le();var l=null,A=Re(()=>{var c=a();return me(c)?c:c==null?[]:te(c)}),s,p=!0;function _(){n.fallback=l,_r(n,s,f,r,t),l!==null&&(s.length===0?(l.f&M)===0?Ae(l):(l.f^=M,U(l,null,f)):Te(l,()=>{l=null}))}var T=Pe(()=>{s=E(A);var c=s.length;let C=!1;if(k){var I=Me(f)===De;I!==(c===0)&&(f=ve(),Q(f),V(!1),C=!0)}for(var S=new Set,P=G,g=Fe(),v=0;v<c;v+=1){k&&W.nodeType===$e&&W.data===He&&(f=W,C=!0,V(!1));var m=s[v],N=t(m,v),y=p?null:h.get(N);y?(y.v&&he(y.v,m),y.i&&he(y.i,v),g&&P.skipped_effects.delete(y.e)):(y=yr(h,p?f:_e??(_e=Z()),m,N,v,o,r,a),p||(y.e.f|=M),h.set(N,y)),S.add(N)}if(c===0&&i&&!l&&(p?l=B(()=>i(f)):(l=B(()=>i(_e??(_e=Z()))),l.f|=M)),k&&c>0&&Q(ve()),!p)if(g){for(const[$,H]of h)S.has($)||P.skipped_effects.add(H.e);P.oncommit(_),P.ondiscard(()=>{})}else _();C&&V(!0),E(A)}),n={effect:T,items:h,outrogroups:null,fallback:l};p=!1,k&&(f=W)}function _r(e,r,a,t,o){var y,$,H,ie,oe,ue,fe,ce,le;var i=(t&ze)!==0,f=r.length,h=e.items,u=e.effect.first,d,l=null,A,s=[],p=[],_,T,n,c;if(i)for(c=0;c<f;c+=1)_=r[c],T=o(_,c),n=h.get(T).e,(n.f&M)===0&&(($=(y=n.nodes)==null?void 0:y.a)==null||$.measure(),(A??(A=new Set)).add(n));for(c=0;c<f;c+=1){if(_=r[c],T=o(_,c),n=h.get(T).e,e.outrogroups!==null)for(const L of e.outrogroups)L.pending.delete(n),L.done.delete(n);if((n.f&M)!==0)if(n.f^=M,n===u)U(n,null,a);else{var C=l?l.next:u;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),D(e,l,n),D(e,n,C),U(n,C,a),l=n,s=[],p=[],u=l.next;continue}if((n.f&x)!==0&&(Ae(n),i&&((ie=(H=n.nodes)==null?void 0:H.a)==null||ie.unfix(),(A??(A=new Set)).delete(n))),n!==u){if(d!==void 0&&d.has(n)){if(s.length<p.length){var I=p[0],S;l=I.prev;var P=s[0],g=s[s.length-1];for(S=0;S<s.length;S+=1)U(s[S],I,a);for(S=0;S<p.length;S+=1)d.delete(p[S]);D(e,P.prev,g.next),D(e,l,P),D(e,g,I),u=I,l=g,c-=1,s=[],p=[]}else d.delete(n),U(n,u,a),D(e,n.prev,n.next),D(e,n,l===null?e.effect.first:l.next),D(e,l,n),l=n;continue}for(s=[],p=[];u!==null&&u!==n;)(d??(d=new Set)).add(u),p.push(u),u=u.next;if(u===null)continue}(n.f&M)===0&&s.push(n),l=n,u=n.next}if(e.outrogroups!==null){for(const L of e.outrogroups)L.pending.size===0&&(re(te(L.done)),(oe=e.outrogroups)==null||oe.delete(L));e.outrogroups.size===0&&(e.outrogroups=null)}if(u!==null||d!==void 0){var v=[];if(d!==void 0)for(n of d)(n.f&x)===0&&v.push(n);for(;u!==null;)(u.f&x)===0&&u!==e.fallback&&v.push(u),u=u.next;var m=v.length;if(m>0){var N=(t&be)!==0&&f===0?a:null;if(i){for(c=0;c<m;c+=1)(fe=(ue=v[c].nodes)==null?void 0:ue.a)==null||fe.measure();for(c=0;c<m;c+=1)(le=(ce=v[c].nodes)==null?void 0:ce.a)==null||le.fix()}gr(e,v,N)}}i&&Ee(()=>{var L,de;if(A!==void 0)for(n of A)(de=(L=n.nodes)==null?void 0:L.a)==null||de.apply()})}function yr(e,r,a,t,o,i,f,h){var u=(f&qe)!==0?(f&Ye)===0?Je(a,!1,!1):ge(a):null,d=(f&Ue)!==0?ge(o):null;return Se&&u&&(u.trace=()=>{h()[(d==null?void 0:d.v)??o]}),{v:u,i:d,e:B(()=>(i(r,u??a,d??o,h),()=>{e.delete(t)}))}}function U(e,r,a){if(e.nodes)for(var t=e.nodes.start,o=e.nodes.end,i=r&&(r.f&M)===0?r.nodes.start:a;t!==null;){var f=Ve(t);if(i.before(t),t===o)return;t=f}}function D(e,r,a){r===null?e.effect.first=a:r.next=a,a===null?e.effect.last=r:a.prev=r}function pr(e,r){var a=void 0,t;ke(()=>{a!==(a=r())&&(t&&(K(t),t=null),a&&(t=B(()=>{ne(()=>a(e))})))})}function br(e,r,a,t,o,i){var f=e.__className;if(k||f!==a||f===void 0){var h=dr(a,t,i);(!k||h!==e.getAttribute("class"))&&(h==null?e.removeAttribute("class"):r?e.className=h:e.setAttribute("class",h)),e.__className=a}else if(i&&o!==i)for(var u in i){var d=!!i[u];(o==null||d!==!!o[u])&&e.classList.toggle(u,d)}return i}function ee(e,r={},a,t){for(var o in a){var i=a[o];r[o]!==i&&(a[o]==null?e.style.removeProperty(o):e.style.setProperty(o,i,t))}}function Sr(e,r,a,t){var o=e.__style;if(k||o!==r){var i=vr(r,t);(!k||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=r}else t&&(Array.isArray(t)?(ee(e,a==null?void 0:a[0],t[0]),ee(e,a==null?void 0:a[1],t[1],"important")):ee(e,a,t));return t}function j(e,r,a=!1){if(e.multiple){if(r==null)return;if(!me(r))return Ke();for(var t of e.options)t.selected=r.includes(z(t));return}for(t of e.options){var o=z(t);if(je(o,r)){t.selected=!0;return}}(!a||r!==void 0)&&(e.selectedIndex=-1)}function Ne(e){var r=new MutationObserver(()=>{j(e,e.__value)});r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ge(()=>{r.disconnect()})}function qr(e,r,a=r){var t=new WeakSet,o=!0;We(e,"change",i=>{var f=i?"[selected]":":checked",h;if(e.multiple)h=[].map.call(e.querySelectorAll(f),z);else{var u=e.querySelector(f)??e.querySelector("option:not([disabled])");h=u&&z(u)}a(h),G!==null&&t.add(G)}),ne(()=>{var i=r();if(e===document.activeElement){var f=Xe??G;if(t.has(f))return}if(j(e,i,o),o&&i===void 0){var h=e.querySelector(":checked");h!==null&&(i=z(h),a(i))}e.__value=i,o=!1}),Ne(e)}function z(e){return"__value"in e?e.__value:e.value}const J=Symbol("class"),q=Symbol("style"),we=Symbol("is custom element"),Oe=Symbol("is html");function mr(e){if(k){var r=!1,a=()=>{if(!r){if(r=!0,e.hasAttribute("value")){var t=e.value;X(e,"value",null),e.value=t}if(e.hasAttribute("checked")){var o=e.checked;X(e,"checked",null),e.checked=o}}};e.__on_r=a,Ee(a),rr()}}function Yr(e,r){var a=se(e);a.value===(a.value=r??void 0)||e.value===r&&(r!==0||e.nodeName!=="PROGRESS")||(e.value=r??"")}function Ar(e,r){r?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function X(e,r,a,t){var o=se(e);if(k&&(o[r]=e.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&e.nodeName==="LINK")){t||Er(e,r,a??"");return}o[r]!==(o[r]=a)&&(r==="loading"&&(e[nr]=a),a==null?e.removeAttribute(r):typeof a!="string"&&Ie(e).includes(r)?e[r]=a:e.setAttribute(r,a))}function Tr(e,r,a,t,o=!1,i=!1){if(k&&o&&e.tagName==="INPUT"){var f=e,h=f.type==="checkbox"?"defaultChecked":"defaultValue";h in a||mr(f)}var u=se(e),d=u[we],l=!u[Oe];let A=k&&d;A&&V(!1);var s=r||{},p=e.tagName==="OPTION";for(var _ in r)_ in a||(a[_]=null);a.class?a.class=hr(a.class):a[J]&&(a.class=null),a[q]&&(a.style??(a.style=null));var T=Ie(e);for(const g in a){let v=a[g];if(p&&g==="value"&&v==null){e.value=e.__value="",s[g]=v;continue}if(g==="class"){var n=e.namespaceURI==="http://www.w3.org/1999/xhtml";br(e,n,v,t,r==null?void 0:r[J],a[J]),s[g]=v,s[J]=a[J];continue}if(g==="style"){Sr(e,v,r==null?void 0:r[q],a[q]),s[g]=v,s[q]=a[q];continue}var c=s[g];if(!(v===c&&!(v===void 0&&e.hasAttribute(g)))){s[g]=v;var C=g[0]+g[1];if(C!=="$$")if(C==="on"){const m={},N="$$"+g;let y=g.slice(2);var I=lr(y);if(or(y)&&(y=y.slice(0,-7),m.capture=!0),!I&&c){if(v!=null)continue;e.removeEventListener(y,s[N],m),s[N]=null}if(v!=null)if(I)e[`__${y}`]=v,fr([y]);else{let $=function(H){s[g].call(this,H)};s[N]=ur(y,e,$,m)}else I&&(e[`__${y}`]=void 0)}else if(g==="style")X(e,g,v);else if(g==="autofocus")xe(e,!!v);else if(!d&&(g==="__value"||g==="value"&&v!=null))e.value=e.__value=v;else if(g==="selected"&&p)Ar(e,v);else{var S=g;l||(S=cr(S));var P=S==="defaultValue"||S==="defaultChecked";if(v==null&&!d&&!P)if(u[g]=null,S==="value"||S==="checked"){let m=e;const N=r===void 0;if(S==="value"){let y=m.defaultValue;m.removeAttribute(S),m.defaultValue=y,m.value=m.__value=N?y:null}else{let y=m.defaultChecked;m.removeAttribute(S),m.defaultChecked=y,m.checked=N?y:!1}}else e.removeAttribute(g);else P||T.includes(S)&&(d||typeof v!="string")?(e[S]=v,S in u&&(u[S]=er)):typeof v!="function"&&X(e,S,v,i)}}}return A&&V(!0),s}function Ur(e,r,a=[],t=[],o=[],i,f=!1,h=!1){Ze(o,a,t,u=>{var d=void 0,l={},A=e.nodeName==="SELECT",s=!1;if(ke(()=>{var _=r(...u.map(E)),T=Tr(e,d,_,i,f,h);s&&A&&"value"in _&&j(e,_.value);for(let c of Object.getOwnPropertySymbols(l))_[c]||K(l[c]);for(let c of Object.getOwnPropertySymbols(_)){var n=_[c];c.description===Qe&&(!d||n!==d[c])&&(l[c]&&K(l[c]),l[c]=B(()=>pr(e,()=>n))),T[c]=n}d=T}),A){var p=e;ne(()=>{j(p,d.value,!0),Ne(p)})}s=!0})}function se(e){return e.__attributes??(e.__attributes={[we]:e.nodeName.includes("-"),[Oe]:e.namespaceURI===ar})}var ye=new Map;function Ie(e){var r=e.getAttribute("is")||e.nodeName,a=ye.get(r);if(a)return a;ye.set(r,a=[]);for(var t,o=e,i=Element.prototype;i!==o;){t=ir(o);for(var f in t)t[f].set&&a.push(f);o=tr(o)}return a}function Er(e,r,a){Se&&(r==="srcset"&&kr(e,a)||ae(e.getAttribute(r)??"",a)||sr(r,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(a)))}function ae(e,r){return e===r?!0:new URL(e,document.baseURI).href===new URL(r,document.baseURI).href}function pe(e){return e.split(",").map(r=>r.trim().split(" ").filter(Boolean))}function kr(e,r){var a=pe(e.srcset),t=pe(r);return t.length===a.length&&t.every(([o,i],f)=>i===a[f][1]&&(ae(a[f][0],o)||ae(o,a[f][0])))}const Nr="/api";async function b(e,r){const a=await fetch(`${Nr}${e}`,{...r,headers:{"Content-Type":"application/json",...r==null?void 0:r.headers}});if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()}async function wr(){return b("/xiaomi")}async function Vr(e){return b(`/xiaomi/${e}/status`)}async function zr(e,r){return b(`/xiaomi/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function Or(){return b("/roborock/status")}async function Br(e){return b("/roborock/command",{method:"POST",body:JSON.stringify({cmd:e})})}async function Wr(){return b("/roborock/rooms")}async function Gr(){return b("/roborock/volume")}async function Kr(e){return b("/roborock/volume",{method:"POST",body:JSON.stringify({volume:e})})}async function jr(e){return b("/roborock/fan-speed",{method:"POST",body:JSON.stringify({mode:e})})}async function Xr(e){return b("/roborock/mop-mode",{method:"POST",body:JSON.stringify({mode:e})})}async function Zr(e){return b("/roborock/clean-segments",{method:"POST",body:JSON.stringify({segments:e})})}async function Qr(){return b("/roborock/consumables")}async function xr(e){return b("/roborock/reset-consumable",{method:"POST",body:JSON.stringify({consumable:e})})}async function ea(){return b("/presets")}async function ra(e){return b(`/presets/${e}/apply`,{method:"POST"})}async function Ir(){return b("/schedules")}async function aa(e,r,a){return b("/schedules",{method:"POST",body:JSON.stringify({name:e,preset:r,time:a})})}async function ta(e){return b(`/schedules/${e}`,{method:"DELETE"})}async function na(e){return b(`/schedules/${e}/toggle`,{method:"PATCH"})}async function Pr(){return b("/pending-actions")}async function sa(){return b("/pending-actions",{method:"DELETE"})}async function Cr(e=!1){return b(`/devices${e?"?refresh=true":""}`)}async function Lr(){return b("/yamaha")}async function ia(e){return b(`/yamaha/${e}/status`)}async function oa(e,r){return b(`/yamaha/${e}/control`,{method:"POST",body:JSON.stringify(r)})}async function Rr(){return b("/purifier/status")}async function ua(e){return b("/purifier/control",{method:"POST",body:JSON.stringify(e)})}let O=null,Y=1e3;function Mr(){let e=R(F([])),r=F(new Map),a=R(null),t=R(F([])),o=R(F([])),i=R(F([])),f=R(F([])),h=R(null),u=R(!1),d=null,l=R(!1);function A(){if((O==null?void 0:O.readyState)===WebSocket.OPEN)return;const s=location.protocol==="https:"?"wss:":"ws:";O=new WebSocket(`${s}//${location.host}/ws`),O.onopen=()=>{console.log("WebSocket connected"),w(l,!0),Y=1e3},O.onclose=()=>{console.log(`WebSocket disconnected, reconnecting in ${Y}ms`),w(l,!1),setTimeout(A,Y),Y=Math.min(Y*2,3e4)},O.onerror=()=>{O==null||O.close()},O.onmessage=p=>{try{const _=JSON.parse(p.data);if(_.type==="lamp_status"&&_.deviceId&&_.status){r.set(_.deviceId,_.status);const T=E(e).find(n=>n.id===_.deviceId);T&&(T.online=1)}else if(_.type==="lamp_offline"&&_.deviceId){r.delete(_.deviceId);const T=E(e).find(n=>n.id===_.deviceId);T&&(T.online=0)}}catch{}}}return{get lamps(){return E(e)},get lampStatuses(){return r},get roborock(){return E(a)},get schedules(){return E(t)},get pendingActions(){return E(o)},get tuyaDevices(){return E(i)},get yamahaDevices(){return E(f)},get airPurifier(){return E(h)},get loading(){return E(u)},get error(){return d},get wsConnected(){return E(l)},initWebSocket(){A()},updateLampStatus(s,p){r.set(s,p)},async refreshLamps(){try{w(e,await wr(),!0);for(const s of E(e))if(s.last_status)try{r.set(s.id,JSON.parse(s.last_status))}catch{}}catch(s){console.error("Failed to fetch lamps:",s)}},async refreshRoborock(){try{w(a,await Or(),!0)}catch{w(a,null)}},async refreshSchedules(){try{w(t,await Ir(),!0)}catch(s){console.error("Failed to fetch schedules:",s)}},async refreshPending(){try{w(o,await Pr(),!0)}catch(s){console.error("Failed to fetch pending actions:",s)}},async refreshTuya(s=!0){try{w(i,await Cr(s),!0)}catch(p){console.error("Failed to fetch Tuya devices:",p)}},async refreshYamaha(){try{w(f,await Lr(),!0)}catch(s){console.error("Failed to fetch Yamaha devices:",s)}},async refreshAirPurifier(){try{w(h,await Rr(),!0)}catch{w(h,null)}},async refreshAll(){w(u,!0),await Promise.all([this.refreshLamps(),this.refreshRoborock(),this.refreshSchedules(),this.refreshPending(),this.refreshTuya(),this.refreshYamaha(),this.refreshAirPurifier()]),w(u,!1)}}}const fa=Mr();export{Kr as A,ia as B,oa as C,ua as D,br as a,qr as b,aa as c,ta as d,Jr as e,sa as f,ra as g,ea as h,Ur as i,Fr as j,X as k,zr as l,Vr as m,Yr as n,Wr as o,Gr as p,Qr as q,mr as r,fa as s,na as t,Br as u,jr as v,Xr as w,Sr as x,Zr as y,xr as z};
